#include <iostream>

#define _USE_MATH_DEFINES
#include <math.h>
#include <iostream>

#include "moebius.h"
// matrix manipulation
#define GLM_FORCE_RADIANS
#include <glm/gtc/matrix_transform.hpp>
#include <glm/gtx/transform.hpp>

const GLfloat MoebiusStrip::g_vertex[] = {
  //Start of inner strip
  0.5, 0.0, -0.0,
  0.49794242653084547, 0.0523358579468598, -0.026167978121471914,
  0.49175299781794896, 0.10452532640710911, -0.05226423163382673,
  0.48138280009927714, 0.156410753180003, -0.07821723252011543,
  0.4667543088654126, 0.20781240729824205, -0.10395584540887966,
  0.44776725191553474, 0.2585185434277329, -0.12940952255126037,
  0.42430655222804076, 0.3082767551049994, -0.1545084971874737,
  0.39625209391820715, 0.3567869879254412, -0.17918397477265013,
  0.3634899933544712, 0.4036965356346558, -0.20336832153790008,
  0.32592500498532345, 0.4485972842912763, -0.22699524986977337,
  0.28349364905389035, 0.49102540378443854, -0.24999999999999997,
  0.23617761734950202, 0.5304636137400597, -0.2723195175075135,
  0.18401699437494742, 0.5663460741482469, -0.29389262614623657,
  0.12712282538840325, 0.5980658719242543, -0.31466019552491875,
  0.06568856997142318, 0.6249849951848219, -0.3345653031794291,
  3.958343855148033e-17, 0.6464466094067263, -0.35355339059327373,
  -0.06955686626363107, 0.6617893759258066, -0.37157241273869707,
  -0.14249015753312658, 0.6703634854346763, -0.3885729807284854,
  -0.21819917837427724, 0.6715480191076799, -0.4045084971874737,
  -0.2959743166807724, 0.6647691993961872, -0.41933528397271197,
  -0.37499999999999983, 0.649519052838329, -0.4330127018922193,
  -0.4543607920785753, 0.6253739795879132, -0.4455032620941839,
  -0.5330506380540195, 0.592012709660481, -0.45677272882130043,
  -0.6099851818166275, 0.5492331246694444, -0.46679021324860087,
  -0.6840169943749473, 0.4969674362918031, -0.47552825814757677,
  -0.753953469763432, 0.43529523872436976, -0.48296291314453416,
  -0.8185770672739225, 0.36445399148608554, -0.48907380036690284,
  -0.8766675076203245, 0.284846540273255, -0.4938441702975689,
  -0.9270254679569822, 0.19704534604947938, -0.49726094768413664,
  -0.9684972681689514, 0.10179316472779469, -0.4993147673772869,
  -1.0, 1.2246467991473532e-16, -0.5,
  -1.020546522567595, -0.10726376180751253, -0.4993147673772869,
  -1.0292697335106291, -0.21877803558603898, -0.4972609476841367,
  -1.0254455249699828, -0.3331874484766403, -0.49384417029756883,
  -1.0085138480112794, -0.4490192946655143, -0.48907380036690284,
  -0.9780973378054453, -0.5647047612756303, -0.48296291314453416,
  -0.9340169943749476, -0.6786030682931431, -0.4755282581475768,
  -0.8763044691381612, -0.7890280880482721, -0.46679021324860087,
  -0.8052105746636968, -0.8942769412943073, -0.4567727288213005,
  -0.721209712506371, -0.9926600091619816, -0.44550326209418395,
  -0.6250000000000006, -1.082531754730548, -0.43301270189221935,
  -0.5174989694708277, -1.1623217158890147, -0.41933528397271197,
  -0.3998348103756177, -1.2305650134826271, -0.4045084971874737,
  -0.2733332241023925, -1.2859317160329349, -0.3885729807284855,
  -0.13950006027167677, -1.32725441481074, -0.37157241273869723,
  -2.4864372408976496e-16, -1.3535533905932737, -0.3535533905932738,
  0.1433683565638843, -1.3640587955517247, -0.334565303179429,
  0.2887005562471155, -1.358229329543357, -0.3146601955249187,
  0.4340169943749472, -1.3357669584420604, -0.2938926261462366,
  0.5772956688020979, -1.2966273015451424, -0.27231951750751365,
  0.7165063509461098, -1.2410254037844386, -0.24999999999999997,
  0.8496454995996224, -1.1694367044586187, -0.22699524986977343,
  0.9747712193632457, -1.0825931153201325, -0.20336832153790002,
  1.0900375570365806, -0.9814742247922761, -0.17918397477265033,
  1.193727436521854, -0.8672937494799472, -0.15450849718747375,
  1.284283555653342, -0.7414814565722677, -0.1294095225512605,
  1.3603366064197893, -0.6056608788533583, -0.10395584540887966,
  1.42073023249103, -0.46162323556989215, -0.07821723252011549,
  1.4645422036496623, -0.31129805522841036, -0.05226423163382687,
  1.4911013642057012, -0.1567210685884484, -0.026167978121472125,

// Start of outer strip
  1.5, 0.0, 0.0,
  1.4911013642057012, 0.15672106858844712, 0.026167978121471914,
  1.4645422036496625, 0.31129805522840953, 0.05226423163382673,
  1.42073023249103, 0.4616232355698918, 0.07821723252011543,
  1.360336606419789, 0.6056608788533583, 0.10395584540887966,
  1.2842835556533427, 0.7414814565722669, 0.12940952255126037,
  1.1937274365218542, 0.8672937494799469, 0.1545084971874737,
  1.0900375570365815, 0.9814742247922752, 0.17918397477265013,
  0.9747712193632453, 1.0825931153201325, 0.20336832153790008,
  0.8496454995996228, 1.1694367044586185, 0.22699524986977337,
  0.7165063509461098, 1.2410254037844386, 0.24999999999999997,
  0.5772956688020987, 1.2966273015451422, 0.2723195175075135,
  0.43401699437494745, 1.3357669584420602, 0.29389262614623657,
  0.2887005562471152, 1.358229329543357, 0.31466019552491875,
  0.14336835656388372, 1.3640587955517245, 0.3345653031794291,
  8.288124136325499e-17, 1.3535533905932737, 0.35355339059327373,
  -0.13950006027167558, 1.3272544148107404, 0.37157241273869707,
  -0.2733332241023917, 1.2859317160329353, 0.3885729807284854,
  -0.39983481037561747, 1.2305650134826276, 0.4045084971874737,
  -0.5174989694708277, 1.162321715889015, 0.41933528397271197,
  -0.6249999999999998, 1.0825317547305484, 0.4330127018922193,
  -0.7212097125063707, 0.9926600091619817, 0.4455032620941839,
  -0.8052105746636962, 0.8942769412943079, 0.45677272882130043,
  -0.8763044691381612, 0.7890280880482716, 0.46679021324860087,
  -0.9340169943749473, 0.6786030682931434, 0.47552825814757677,
  -0.9780973378054454, 0.5647047612756301, 0.48296291314453416,
  -1.0085138480112794, 0.44901929466551455, 0.48907380036690284,
  -1.0254455249699825, 0.33318744847663995, 0.4938441702975689,
  -1.0292697335106291, 0.21877803558603923, 0.49726094768413664,
  -1.0205465225675951, 0.10726376180751279, 0.4993147673772869,
  -1.0, 1.2246467991473532e-16, 0.5,
  -0.9684972681689515, -0.10179316472779447, 0.4993147673772869,
  -0.9270254679569823, -0.19704534604947915, 0.4972609476841367,
  -0.8766675076203245, -0.28484654027325523, 0.49384417029756883,
  -0.8185770672739227, -0.3644539914860853, 0.48907380036690284,
  -0.7539534697634319, -0.4352952387243699, 0.48296291314453416,
  -0.6840169943749476, -0.4969674362918029, 0.4755282581475768,
  -0.6099851818166273, -0.5492331246694445, 0.46679021324860087,
  -0.5330506380540201, -0.5920127096604807, 0.4567727288213005,
  -0.4543607920785755, -0.6253739795879131, 0.44550326209418395,
  -0.3750000000000004, -0.6495190528383289, 0.43301270189221935,
  -0.2959743166807725, -0.6647691993961873, 0.41933528397271197,
  -0.21819917837427744, -0.6715480191076799, 0.4045084971874737,
  -0.14249015753312705, -0.6703634854346763, 0.3885729807284855,
  -0.0695568662636317, -0.6617893759258067, 0.37157241273869723,
  -1.1875031565444098e-16, -0.6464466094067263, 0.3535533905932738,
  0.06568856997142343, -0.6249849951848218, 0.334565303179429,
  0.12712282538840336, -0.5980658719242543, 0.3146601955249187,
  0.1840169943749473, -0.5663460741482469, 0.2938926261462366,
  0.23617761734950166, -0.5304636137400598, 0.27231951750751365,
  0.28349364905389035, -0.49102540378443854, 0.24999999999999997,
  0.32592500498532334, -0.4485972842912764, 0.22699524986977343,
  0.36348999335447124, -0.40369653563465563, 0.20336832153790002,
  0.39625209391820687, -0.3567869879254415, 0.17918397477265033,
  0.4243065522280407, -0.3082767551049995, 0.15450849718747375,
  0.44776725191553457, -0.25851854342773317, 0.1294095225512605,
  0.46675430886541264, -0.20781240729824205, 0.10395584540887966,
  0.48138280009927714, -0.1564107531800031, 0.07821723252011549,
  0.4917529978179489, -0.10452532640710939, 0.05226423163382687,
  0.49794242653084547, -0.05233585794686022, 0.026167978121472125,
};

const int MoebiusStrip::g_nPoints = 120;

const GLushort MoebiusStrip::g_index[] = {
  0, 60, 1,
  60, 1, 61,
  1, 61, 2,
  61, 2, 62,
  2, 62, 3,
  62, 3, 63,
  3, 63, 4,
  63, 4, 64,
  4, 64, 5,
  64, 5, 65,
  5, 65, 6,
  65, 6, 66,
  6, 66, 7,
  66, 7, 67,
  7, 67, 8,
  67, 8, 68,
  8, 68, 9,
  68, 9, 69,
  9, 69, 10,
  69, 10, 70,
  10, 70, 11,
  70, 11, 71,
  11, 71, 12,
  71, 12, 72,
  12, 72, 13,
  72, 13, 73,
  13, 73, 14,
  73, 14, 74,
  14, 74, 15,
  74, 15, 75,
  15, 75, 16,
  75, 16, 76,
  16, 76, 17,
  76, 17, 77,
  17, 77, 18,
  77, 18, 78,
  18, 78, 19,
  78, 19, 79,
  19, 79, 20,
  79, 20, 80,
  20, 80, 21,
  80, 21, 81,
  21, 81, 22,
  81, 22, 82,
  22, 82, 23,
  82, 23, 83,
  23, 83, 24,
  83, 24, 84,
  24, 84, 25,
  84, 25, 85,
  25, 85, 26,
  85, 26, 86,
  26, 86, 27,
  86, 27, 87,
  27, 87, 28,
  87, 28, 88,
  28, 88, 29,
  88, 29, 89,
  29, 89, 30,
  89, 30, 90,
  30, 90, 31,
  90, 31, 91,
  31, 91, 32,
  91, 32, 92,
  32, 92, 33,
  92, 33, 93,
  33, 93, 34,
  93, 34, 94,
  34, 94, 35,
  94, 35, 95,
  35, 95, 36,
  95, 36, 96,
  36, 96, 37,
  96, 37, 97,
  37, 97, 38,
  97, 38, 98,
  38, 98, 39,
  98, 39, 99,
  39, 99, 40,
  99, 40, 100,
  40, 100, 41,
  100, 41, 101,
  41, 101, 42,
  101, 42, 102,
  42, 102, 43,
  102, 43, 103,
  43, 103, 44,
  103, 44, 104,
  44, 104, 45,
  104, 45, 105,
  45, 105, 46,
  105, 46, 106,
  46, 106, 47,
  106, 47, 107,
  47, 107, 48,
  107, 48, 108,
  48, 108, 49,
  108, 49, 109,
  49, 109, 50,
  109, 50, 110,
  50, 110, 51,
  110, 51, 111,
  51, 111, 52,
  111, 52, 112,
  52, 112, 53,
  112, 53, 113,
  53, 113, 54,
  113, 54, 114,
  54, 114, 55,
  114, 55, 115,
  55, 115, 56,
  115, 56, 116,
  56, 116, 57,
  116, 57, 117,
  57, 117, 58,
  117, 58, 118,
  58, 118, 59,
  118, 59, 119,
  59, 119, 60,
  119, 60, 0
};

const int MoebiusStrip::g_nIndices = 360;

/* Returns normal at section of strip aroung p1index1 */
glm::vec3 MoebiusStrip::getUnitNormal(int p1index1, int p1index2, int p2index1, int p2index2) {
    glm::vec3 normal =  glm::cross(getVertex(p1index1) - getVertex(p1index2),
                                   getVertex(p2index1) - getVertex(p2index2));
    if (glm::length(normal) < 0.001) {
        return glm::vec3(0.0, 0.0, 0.0);
    }
    else {
       return normal / glm::length(normal);
    }
}


// TODO Fix static/instance mess
void MoebiusStrip::calculateNormals() {
    for (int i = 0; i < g_nNormals * 3; i = i + 3) {
        glm::vec3 normal = getUnitNormal(g_index[i], g_index[i + 1], g_index[i + 1], g_index[i + 2]);
        g_normal[i] = normal.x;
        g_normal[i + 1] = normal.y;
        g_normal[i + 2] = normal.z;
    std::cerr << "Called: " << i  + 2<<"\n";
    }
}
